// Phase 1: Load burn-in
// Allow recessive deleterious mutations to spread throughout the population

initialize() {
//Parameters
defineConstant("K_ancestral", 5000); // Population size 5000
defineConstant("L", 23e6); // Chromosome 2L
defineConstant("Rec_rate", 2.4e-8); // Recombination rate
defineConstant("Inv_start", 2e6); 
defineConstant("Inv_end", 13e6); // 11 MB inversion
defineConstant("MU_total", 3e-9); // Mutation rate
defineConstant("DFE_shape", 0.33); // gamma distribution shape
defineConstant("DFE_mean_s", -0.001); // Mean selection coefficient
defineConstant("H_dominance", 0.0); // Fully recessive
defineConstant("Burnin_gen", 10 * K_ancestral); // Burn-in gen = 10N
// Model setup
initializeSLiMModelType("nonWF");
// Neutral mutation m1
initializeMutationType("m1", 0.5, "f", 0.0);
m1.convertToSubstitution = F;
// Deleterious mutation m2
initializeMutationType("m2", H_dominance, "g", DFE_mean_s, DFE_shape);
m2.convertToSubstitution = F;
// Inversion marker m3
initializeMutationType("m3", 0.5, "f", 0.0);
defineConstant("Inv_marker", integerDiv(Inv_start + Inv_end, 2));
initializeGenomicElementType("g1", c(m1, m2), c(0.26, 0.74)); // 26% neutral, 74% deleterious
initializeGenomicElement(g1, 0, L-1); // Standard chromosome
initializeMutationRate(MU_total);
initializeRecombinationRate(Rec_rate);
}

// Population
1 early() {
sim.addSubpop("p1", K_ancestral); // Ancestral population p1
defineConstant("simID", getSeed());
}

// Reproduction
reproduction() { // Birth process
mate1 = p1.sampleIndividuals(1);
mate2 = p1.sampleIndividuals(1);
p1.addCrossed(mate1, mate2);
}

// Death
1:Burnin_gen early() { // Population size control
p1.fitnessScaling = K_ancestral / p1.individualCount;
}

// Logging
1:Burnin_gen late() {
if (sim.cycle % 1000 == 0) {
// Mean fitness (before density scaling)
meanFit = mean(p1.cachedFitness(NULL));
// Total deleterious mutation count 
total_m2 = sum(p1.genomes.countOfMutationsOfType(m2));
// Homozygous deleterious burden
hom_m2 = 0;
for (ind in p1.individuals) {
hom_m2 = hom_m2 +
sum(ind.genome1.countOfMutationsOfType(m2) &
ind.genome2.countOfMutationsOfType(m2));
}
catn("Gen: " + sim.cycle +
" | N: " + p1.individualCount +
" | MeanFit: " + meanFit +
" | m2 copies: " + total_m2 +
" | homozygous m2: " + hom_m2);
}
}

// Output
Burnin_gen late() { 
catn("Burn-in complete");
sim.outputFull("burnin_state_K=" + K_ancestral + "_simID=" + simID + ".txt");
sim.simulationFinished();
}














